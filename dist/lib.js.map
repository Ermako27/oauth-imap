{"version":3,"file":"lib.js","sources":["../src/index.js"],"sourcesContent":["function getParameterByName(name, url) {\n    if (!url) url = window.location.href;\n    name = name.replace(/[\\[\\]]/g, '\\\\$&');\n    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n        results = regex.exec(url);\n    if (!results) return null;\n    if (!results[2]) return '';\n    return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n}\n\n\nfunction getToken(code) {\n    const url = 'https://oauth.mail.ru/token'\n\n    const body = 'grant_type=authorization_code'\n    + `&code=${code}`\n    + '&redirect_uri=http://127.0.0.1:8000'\n    console.log(body);\n    return fetch(url, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body,\n        mode: 'no-cors'\n    })\n        .then(response => {\n            console.log(response)\n            return response.json();\n        })\n        .then((response) => {\n            if (!response.access_token){\n                console.log(`Error ${response.error}: ${response.error_description}`);\n                context.setState({error: response.error_description});\n                window.open(context.linkToGetCode, '_self');\n            } else {\n                context.setState({response});\n            }\n        })\n}\n\nexport default class Lib {\n    constructor() {\n        this.code = ''\n    }\n\n\n    fetchAccessCode() {\n        const url = \n            'https://oauth.mail.ru/login'\n            + '?client_id=d107a66dd260467fa71c9b863b196e7c'\n            + '&response_type=code'\n            + '&scope=userinfo'\n            + '&redirect_uri=http://127.0.0.1:8000'\n            + '&state=some_state';\n        window.open(url)\n    }\n\n    getAccesCodeFromUrl() {\n        let url = new URL('http://127.0.0.1:8000/' + window.location.search);\n        this.code = url.searchParams.get(\"code\");\n        console.log('CODE', this.code);\n        getToken(this.code);\n    }\n}"],"names":[],"mappings":";;;;;;IAWA,SAAS,QAAQ,CAAC,IAAI,EAAE;IACxB,IAAI,MAAM,GAAG,GAAG,8BAA6B;;IAE7C,IAAI,MAAM,IAAI,GAAG,+BAA+B;IAChD,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IACrB,MAAM,sCAAqC;IAC3C,IAAI,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IACtB,IAAI,OAAO,KAAK,CAAC,GAAG,EAAE;IACtB,QAAQ,MAAM,EAAE,MAAM;IACtB,QAAQ,OAAO,EAAE;IACjB,YAAY,cAAc,EAAE,mCAAmC;IAC/D,SAAS;IACT,QAAQ,IAAI;IACZ,QAAQ,IAAI,EAAE,SAAS;IACvB,KAAK,CAAC;IACN,SAAS,IAAI,CAAC,QAAQ,IAAI;IAC1B,YAAY,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAC;IACjC,YAAY,OAAO,QAAQ,CAAC,IAAI,EAAE,CAAC;IACnC,SAAS,CAAC;IACV,SAAS,IAAI,CAAC,CAAC,QAAQ,KAAK;IAC5B,YAAY,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC;IACvC,gBAAgB,OAAO,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,QAAQ,CAAC,KAAK,CAAC,EAAE,EAAE,QAAQ,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;IACtF,gBAAgB,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,QAAQ,CAAC,iBAAiB,CAAC,CAAC,CAAC;IACtE,gBAAgB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,OAAO,CAAC,CAAC;IAC5D,aAAa,MAAM;IACnB,gBAAgB,OAAO,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;IAC7C,aAAa;IACb,SAAS,CAAC;IACV,CAAC;;AAED,IAAe,MAAM,GAAG,CAAC;IACzB,IAAI,WAAW,GAAG;IAClB,QAAQ,IAAI,CAAC,IAAI,GAAG,GAAE;IACtB,KAAK;;;IAGL,IAAI,eAAe,GAAG;IACtB,QAAQ,MAAM,GAAG;IACjB,YAAY,6BAA6B;IACzC,cAAc,6CAA6C;IAC3D,cAAc,qBAAqB;IACnC,cAAc,iBAAiB;IAC/B,cAAc,qCAAqC;IACnD,cAAc,mBAAmB,CAAC;IAClC,QAAQ,MAAM,CAAC,IAAI,CAAC,GAAG,EAAC;IACxB,KAAK;;IAEL,IAAI,mBAAmB,GAAG;IAC1B,QAAQ,IAAI,GAAG,GAAG,IAAI,GAAG,CAAC,wBAAwB,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IAC7E,QAAQ,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IACjD,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;IACvC,QAAQ,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC5B,KAAK;IACL;;;;;;;;"}